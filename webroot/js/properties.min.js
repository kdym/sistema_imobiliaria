function loadPhotos(){startLoading($("#photo-gallery-box")),$("#photo-gallery-view").html(""),$.ajax({url:"/properties-photos/fetch/"+$(".image-gallery").data("property"),dataType:"json",success:function(e){var o=0;$.each(e,function(){var e="/file/properties/"+$(".image-gallery").data("property")+"/"+this.url,t={id:this.id,photo:e};$("#photo-gallery-template").tmpl(t).appendTo("#photo-gallery-view"),o++}),$("#photo-gallery-view").sortable({placeholder:"photo-gallery-state-highlight",revert:!0,update:sortPhotos}),$(".masonry-list-50").masonry(),0!=o&&$("#delete-photos").prop("disabled",!1),stopLoading($("#photo-gallery-box"))}})}function sortPhotos(){$.ajax({url:"/properties-photos/update-order",type:"post",data:{images:$(this).sortable("serialize")}})}function loadListMap(){var e=$("#list-properties-map").data("properties"),o=new google.maps.Map(document.getElementById("list-properties-map")),t=new google.maps.LatLngBounds;$.each(e,function(){var e=this,a=new google.maps.LatLng(Number(e.latitude),Number(e.longitude));new google.maps.Marker({position:a,map:o}).addListener("click",function(){var t={photo:e.photo,address:e.address,property_id:e.property_id,property_code:e.property_code};new google.maps.InfoWindow({content:$("#property-info-window-template").tmpl(t).html()}).open(o,this)}),t.extend(a)}),o.fitBounds(t)}function loadPropertyMap(){var e=new google.maps.LatLng(Number($("#property-map").data("latitude")),Number($("#property-map").data("longitude"))),o=new google.maps.Map(document.getElementById("property-map"),{center:e,zoom:17,mapTypeControl:!1,fullscreenControl:!1}),t=new google.maps.Marker({position:e,map:o}),a=document.createElement("div");a.innerHTML='<i class="fa fa-pencil"></i>',a.className="custom-maps-button";var r=document.createElement("div");r.innerHTML='<i class="fa fa-floppy-o"></i>',r.className="custom-maps-button";var n=document.createElement("div");n.innerHTML="Arraste o marcador para alterar a posição",n.className="maps-toast",a.addEventListener("click",function(){o.controls[google.maps.ControlPosition.TOP_RIGHT].clear(),o.controls[google.maps.ControlPosition.TOP_RIGHT].push(r),o.controls[google.maps.ControlPosition.TOP_RIGHT].push(n),t.setDraggable(!0)}),r.addEventListener("click",function(){t.setDraggable(!1);var e=this;e.innerHTML='<i class="fa fa-circle-o-notch fa-spin"></i>',$.ajax({type:"post",url:"/properties/update-latitude-longitude",data:{id:$("#property-hidden-id").val(),latitude:t.position.lat(),longitude:t.position.lng()},success:function(){e.innerHTML='<i class="fa fa-floppy-o"></i>',o.controls[google.maps.ControlPosition.TOP_RIGHT].clear(),o.controls[google.maps.ControlPosition.TOP_RIGHT].push(a),o.panTo(t.getPosition())}})}),o.controls[google.maps.ControlPosition.TOP_RIGHT].push(a)}function updateLatitudeLongidute(e){$.ajax({type:"post",url:"/properties/update-latitude-longitude",data:{id:$("#property-hidden-id").val(),latitude:e.position.lat(),longitude:e.position.lng()},success:function(){}})}function checkBills(){$("[data-accept-bill]").prop("readonly",!0),$("[data-check-bill]").each(function(){$(this).prop("checked")&&$("[data-accept-bill="+$(this).data("check-bill")+"]").prop("readonly",!1)})}if($("#cep").blur(function(){getCep($(this),function(e){$("#endereco").val(e.logradouro),$("#bairro").val(e.bairro),$("#cidade").val(e.localidade),$("#uf").val(e.uf)})}),$("#locator-search").autocomplete({source:function(e,o){$.ajax({url:"/locators/fetch.json",data:{name:e.term},dataType:"json",success:function(e){o(e)}})},select:function(e,o){return $("#locator-search").val(o.item.nome+" - "+o.item.formatted_username),$("#locator-id").val(o.item.locator.id),!1}}).autocomplete("instance")._renderItem=function(e,o){var t={name:o.nome,username:o.formatted_username};return $("<li>").append($("#locators-search-template").tmpl(t)).appendTo(e)},$("#broker-search").autocomplete({source:function(e,o){$.ajax({url:"/properties/fetch-broker.json",data:{name:e.term},dataType:"json",success:function(e){o(e)}})},select:function(e,o){return $("#broker-search").val(o.item.nome+" - "+o.item.formatted_username),$("#broker").val(o.item.id),!1}}).autocomplete("instance")._renderItem=function(e,o){var t={name:o.nome,username:o.formatted_username};return $("<li>").append($("#brokers-search-template").tmpl(t)).appendTo(e)},$("#locators-associations-chart").length&&new Chart($("#locators-associations-chart")[0].getContext("2d"),{type:"doughnut",data:{datasets:[{data:$("#locators-associations-chart").data("dataset"),backgroundColor:$("#locators-associations-chart").data("colors")}],labels:$("#locators-associations-chart").data("labels")},options:{responsive:!0,maintainAspectRatio:!1,tooltips:{callbacks:{label:function(e,o){return o.datasets[e.datasetIndex].data[e.index]+"%"}}}}}),$("[data-check-bill]").length&&checkBills(),$("[data-check-bill]").click(function(){checkBills()}),$("#descricao").length&&CKEDITOR.replace("descricao"),$("#list-properties-map").length&&$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){loadListMap()}),$("#property-map").length&&loadPropertyMap(),$(".upload-form").length){Dropzone.autoDiscover=!1;var propertiesUploader=new Dropzone(document.body,{url:"/properties-photos/add",maxFilesize:2,dictFileTooBig:"Tamanho máximo 2MB",acceptedFiles:"image/jpeg,image/png",dictInvalidFileType:"Somente arquivos de imagem (JPG ou PNG)",autoQueue:!1,addRemoveLinks:!0,dictRemoveFile:"Remover",previewsContainer:"#images-preview",clickable:".add-photos-buttton"});propertiesUploader.on("addedfile",function(e){$(".images-preview-instructions").hide(),$(".cancel-upload-button, .upload-photos-button").attr("disabled",!1),$(".masonry-list-50").masonry()}),propertiesUploader.on("removedfile",function(e){0==this.files.length&&($(".images-preview-instructions").show(),$(".cancel-upload-button, .upload-photos-button").attr("disabled",!0),$(".add-photos-buttton").attr("disabled",!1)),$(".masonry-list-50").masonry()}),$(".cancel-upload-button").click(function(){propertiesUploader.removeAllFiles(!0)}),$(".upload-photos-button").click(function(){propertiesUploader.enqueueFiles(propertiesUploader.getFilesWithStatus(Dropzone.ADDED)),$(".add-photos-buttton, .cancel-upload-button, .upload-photos-button").attr("disabled",!0)}),propertiesUploader.on("sending",function(e,o,t){t.append("property_id",$(".image-gallery").data("property"))}),propertiesUploader.on("queuecomplete",function(e){propertiesUploader.removeAllFiles(!0),loadPhotos()}),loadPhotos()}$("#delete-photos").click(function(){if(confirm("Tem certeza que deseja excluir estas fotos?")){var e=[];$(".gallery-checkbox").each(function(){1==$(this).prop("checked")&&e.push($(this).val())}),0!=e.length&&(startLoading($("#photo-gallery-box")),$("#delete-photos").prop("disabled",!0),$.ajax({url:"/properties-photos/delete",type:"delete",data:{ids:e.toString()},success:function(){loadPhotos()}}))}});